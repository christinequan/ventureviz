<!DOCTYPE html>
<html lang="en">
<title>Venture Viz</title>
<head>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
      <script src="//code.jquery.com/jquery-1.10.2.js"></script>
      <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <meta charset="utf-8">
    
    <link href="style.css" rel="stylesheet">
    <link rel="stylesheet" href="font-awesome-4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">

    <script charset="utf-8" src="https://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript"></script>
    <script src="d3-tip-master/index.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="VCviz.js" type="text/javascript"></script>
    <script src="init.js" type="text/javascript"></script>



</head>

<body onload="initialize()">

    <header>        
        <h1>Follow the money.</h1>
    </header>

    <div class="pure-menu custom-restricted-width">
        <span class="pure-menu-heading">Industries</span>

        <ul class="pure-menu-list">
            <li class="pure-menu-item"><a id="biotech" href="#" onclick="loadView(this.id)" class="pure-menu-link">Biotech</a></li>
            <li class="pure-menu-item"><a id="cleantech" href="#" onclick="loadView(this.id)" class="pure-menu-link">Cleantech</a></li>
            <li class="pure-menu-item"><a id="enterprise" href="#" onclick="loadView(this.id)" class="pure-menu-link">Enterprise</a></li>
            <li class="pure-menu-item"><a id="ecommerce" href="#" onclick="loadView(this.id)" class="pure-menu-link">eCommerce</a></li>
            <li class="pure-menu-item"><a id="hardware" href="#" onclick="loadView(this.id)" class="pure-menu-link">Hardware</a></li>
            <li class="pure-menu-item"><a id="health" href="#" onclick="loadView(this.id)" class="pure-menu-link">Health</a></li>
            <li class="pure-menu-item"><a id="mobile" href="#" onclick="loadView(this.id)" class="pure-menu-link">Mobile</a></li>
            <li class="pure-menu-item"><a id="security" href="#" onclick="loadView(this.id)" class="pure-menu-link">Security</a></li>
            <li class="pure-menu-item"><a id="semiconductors" href="#" onclick="loadView(this.id)" class="pure-menu-link">Semiconductors</a></li>
            <li class="pure-menu-item"><a id="software" href="#" onclick="loadView(this.id)" class="pure-menu-link">Software</a></li>

        </ul>
    </div>

    <script type="text/javascript">

        var svg = d3.select("body")
            .append("svg")
            .attr('class', 'svg')
            .attr("width", w+100)
            .attr("height", h+50);


        var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {
                var company = d.company_name;
                var response = "<h3>" + company + "</h3>";
                if (d.funding_round_type == "venture") {
                    response += "<u>Series " + d.funding_round_code +"</u><br>";
                } else if (d.funding_round_type == "seed") {
                    response += "<u>Seed Round</u>"+"<br>";
                } else if (d.funding_round_type == "angel") {
                    response += "<u>Angel Investment</u>"+"<br>";
                } else {
                    response += "<u>Other Investment</u>"+"<br>";
                }

                response += "$" + d.raised_amount_usd + "<p></p>";
                response += "<u>Investors</u><br>";
                for (var i = 1; i < 27; i++) {
                    var property = String(investor_string + i);
                    if (d[property] === "NA") break;
                    response += d[property] + "<br>";
                }

                return response;
            });

        svg.call(tip);

        var biotechURL = "https://dl.dropboxusercontent.com/s/bp3s16msslckh2g/biotechnology_small.csv?dl=0"
        var cleantechURL = "https://dl.dropboxusercontent.com/s/5imaxqfwh5fb7so/cleantechnology_usa.csv?dl=0"
        var curatedwebURL = "https://dl.dropboxusercontent.com/s/1gih7rk2bsyey6a/curatedweb_usa.csv?dl=0"
        var enterpriseURL = "https://dl.dropboxusercontent.com/s/znutk7ft6uimuec/e-commerce_usa.csv?dl=0"
        var ecommerceURL = "https://dl.dropboxusercontent.com/s/nnecx5mxyug3mrz/enterprisesoftware_usa.csv?dl=0"
        var hardwareURL = "https://dl.dropboxusercontent.com/s/miu5se5mbdarld2/hardwareandsoftware_usa.csv?dl=0"
        var healthURL = "https://dl.dropboxusercontent.com/s/0ji157ozgkvdjrf/healthcare_usa.csv?dl=0"
        var mobileURL = "https://dl.dropboxusercontent.com/s/k16eh23dve8qdys/mobile_usa.csv?dl=0"
        var securityURL =   "https://dl.dropboxusercontent.com/s/aqfzq94aei9smwv/security_usa.csv?dl=0"
        var semiconductorsURL = "https://dl.dropboxusercontent.com/s/xgxzsfz0ht20r4x/semiconductors_usa.csv?dl=0"
        var softwareURL = "https://dl.dropboxusercontent.com/s/3pvyvhrtf128z4y/software_usa.csv?dl=0"


        /* Preload all of the industry data into objects */
        var biotechData, cleantechData, curatedwebData, enterpriseData, ecommerceData, hardwareData, healthData, mobileData, securityData, semiconductorsData, softwareData;

        function loadData() {
            queue()
            .defer(d3.csv, biotechURL)
            .defer(d3.csv, cleantechURL)
            .defer(d3.csv, curatedwebURL)
            .defer(d3.csv, enterpriseURL)
            .defer(d3.csv, ecommerceURL)
            .defer(d3.csv, hardwareURL)
            .defer(d3.csv, healthURL)
            .defer(d3.csv, mobileURL)
            .defer(d3.csv, securityURL)
            .defer(d3.csv, semiconductorsURL)
            .defer(d3.csv, softwareURL)
            .await(visualizeData);
        }

        loadData();

        function visualizeData(error, biotechData_L, cleantechData_L, curatedwebData_L, enterpriseData_L, ecommerceData_L, hardwareData_L, healthData_L, mobileData_L, securityData_L, semiconductorsData_L, softwareData_L) {
            if (error) throw error;
            biotechData = biotechData_L;
            cleantechData = cleantechData_L;
            curatedwebData = curatedwebData_L;
            enterpriseData = enterpriseData_L;
            ecommerceData = ecommerceData_L;
            hardwareData = hardwareData_L;
            healthData = healthData_L;
            mobileData = mobileData_L;
            securityData = securityData_L;
            semiconductorsData = semiconductorsData_L;
            softwareData = softwareData_L;

        }
        // Changes colors

        function colorOver(d){
            d3.select(this).style('fill','grey');
        }

        function colorOut(d) {
            var rect = d3.select(this);
            rect.style("fill", function(d) {
                return d.color;
            });
        }

        // Changes the view to the correct industry
        function loadView(clicked_id) {
            
            switch(clicked_id) {
                case 'biotech': data = biotechData; break;
                case 'cleantech': data = cleantechData; break;
                case 'enterprise': data = enterpriseData; break;
                case 'ecommerce': data = ecommerceData; break;
                case 'gaming': data = gamingData; break;
                case 'hardware': data = hardwareData; break;
                case 'health': data = healthData; break;
                case 'mobile': data = mobileData; break;
                case 'security': data = securityData; break;
                case 'semiconductors': data = semiconductorsData; break;
                case 'software': data = softwareData; break;
        }

        // Define the axes
        var scale = d3.scale.linear()
            .domain([0, d3.max(data, function(d) { return parseInt(d['raised_amount_usd']); })])
            .range([0, MAX_BAR_HEIGHT]);

        var yScale = d3.scale.linear()
            .domain([d3.max(data, function(d) { return parseInt(d['raised_amount_usd']); }),0])
            .range([5,MAX_BAR_HEIGHT]);


        dates = data['funded_at'];

        console.log("dates", typeof(dates))

        var maxdate = dates[dates.length-1];
        var mindate = dates[0];

        console.log("min", mindate)
        console.log("max", maxdate)

        var xScale = d3.time.scale()
            .domain([mindate, maxdate])    // values between for month of january
            .range([5, 805]);   // map these the the chart width = total width minus padding at both sides
            

        raised_range[1] = d3.max(data, function(d) { return parseInt(d['raised_amount_usd']); });

        d3.selectAll("svg > *").remove();

        svg.selectAll("rect")
            .data(data)
            .enter()
            .append("rect")
            .attr("width", function() {
                return w / data.length;
            })
            .attr("height", function(d) {
                return scale(d.raised_amount_usd) + "px";
            })
            .attr("x", function(d, i) {
                if ((i * ((w / data.length) + 1)) < 800) {
                return i * ((w / data.length) + 1);}
            })
            .attr("y", function(d) {
                return h - scale(d.raised_amount_usd);
            })

            .attr("fill", function(d) {
                    if (d.funding_round_type == "seed") {
                        return "#edf8b1";
                    } else if (d.funding_round_type == "venture") {
                        if (d.funding_round_code == "A") {
                            return "#c7e9b4";
                        } else if (d.funding_round_code == "B") {
                            return "#7fcdbb";
                        } else if (d.funding_round_code == "C") {
                            return "#41b6c4";
                        } else if (d.fnding_round_code == "D") {
                            return "#1d91c0";
                        } else if (d.funding_round_code == "E") {
                            return "#225ea8";
                        } else if (d.funding_round_code == "F") {
                            return "#253494";
                        } else {
                            return "#081d58";
                        }
                    } else {                                            // angel
                        return "#ffffd9";
                    }
            })
            .on('mouseover', function(d) {
                colorOver.call(this,d);
                tip.show(d);
            })
            .on('mouseout', function(d) {
                colorOut.call(this,d);
                tip.hide(d);
            });

            // define the y axis
            var xAxis = d3.svg.axis()
                .orient("bottom")
                .scale(xScale);

            var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient("right");

            svg.append("g")
                .attr("transform", "translate(805,0)")
                .attr("class", "yaxis")
                .call(yAxis);

            svg.append("g")
                .attr("transform", "translate(0,500)")
                .attr("class", "xaxis")
                .call(xAxis);
        }


    </script>

<div id="slider_container">
    <div class = "slider" id = "time_slide_form">
        <div id="slider-range"></div>
        <label for="amount">Date range:</label> <input type="text" id="amount" style="border: 0; color: #000; font-weight: bold;" size="100"/>
    </div>

    <div class = "slider" id = "amount_slide_form">
        <div id="amt-range"></div>
        <label for="raised">Amount Raised:</label> <input type="text" id="raised" style="border: 0; color: #000; font-weight: bold;" size="100"/>
    </div>
            
</div>
    

</body>
